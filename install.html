<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Zipkin, from Twitter</title>
    <link href="css/bootstrap-2.1.0.min.css" rel="stylesheet">
    <link href="css/docs.css" rel="stylesheet">
    <!--<link href="css/bootstrap-responsive-2.0.4.min.css" rel="stylesheet">-->
  </head>
  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="index.html">Zipkin</a>
          <ul class="nav">
            <li><a href="architecture.html">Architecture</a></li>
            <li><a href="install.html">Install</a></li>
            <li><a href="hadoop.html">Hadoop</a></li>
            <li><a href="instrument.html">Instrumenting a library</a></li>
          </ul>
          <ul class="nav pull-right">
            <li><a href="https://github.com/twitter/zipkin">Github</a></li>
            <li><a href="https://twitter.com/zipkinproject">@ZipkinProject</a></li>
          </ul>
        </div>
      </div>
    </div>

      <header class="jumbotron masthead">
        <div class="inner">
          <h1>Zipkin, from Twitter</h1>
          <p class="lead">A distributed tracing system</p>
        </div>
      </header>

      <div class="container">
        <section id="examples">
<h2>Installation</h2>

<h3>Quickstart</h3>

<p><a href="http://www.scala-lang.org/downloads">Scala 2.9</a> (JDK6 or JDK7) is required.</p>

<p>Install with <code>git clone https://github.com/twitter/zipkin.git &amp;&amp; cd zipkin</code> or
<a href="https://github.com/twitter/zipkin/archive/master.zip">download</a> Zipkin to your
preferred directory and unzip.</p>

<p>Run (in separate bash windows):</p>

<pre><code>bin/collector
bin/query
bin/web
</code></pre>

<p>Now you can access the Zipkin UI at http://localhost:8080/</p>

<h3>Advanced Setup</h3>

<p>By default, Zipkin runs on SQLite because it doesn&#39;t require additional setup.
However, Zipkin is typically used with other databases (most often Cassandra)
in production. For a quickstart with Cassandra, see the
<a href="https://github.com/twitter/zipkin/blob/master/doc/ubuntu-quickstart.txt">Ubuntu Quickstart</a> and
<a href="https://github.com/twitter/zipkin/blob/master/doc/mac-quickstart.md">Mac Quickstart</a> guides.
These will help you get a somewhat more advanced Zipkin installation running on
a single machine so that you can experiment with it.</p>

<p>For larger deployments, Zipkin works with several other services, and you may
want to apply additional configuration. Some of those services and
configurations are described below.</p>

<h3>Feeding trace data to Zipkin</h3>

<p>The next step after installation is to collect trace data to view in Zipkin. To
do this, you must interface with the collector daemon to record trace data.
There are several libraries to make this easier to do in different
environments. Twitter uses
<a href="https://github.com/twitter/finagle/tree/master/finagle-zipkin">Finagle</a>;
external libraries (currently for Python, REST, node, and Java) are listed in the
<a href="https://github.com/twitter/zipkin/wiki#external-projects-that-use-zipkin">wiki</a>;
and there is also a <a href="https://rubygems.org/gems/finagle-thrift">Ruby gem</a> and
<a href="https://github.com/twitter/thrift_client">Ruby Thrift client</a>.</p>

<h3>Running the Daemons with Other Databases</h3>

<p>The default Zipkin collector configuration is
<code>zipkin-collector-service/config/collector-dev.scala</code> and the default Zipkin
query configuration is <code>zipkin-query-service/config/query-dev.scala</code>. These
are set up to work with SQLite by default. To use Zipkin with a different SQL
database, we recommend changing those configurations as described in the
<a href="https://github.com/twitter/zipkin/blob/master/doc/sql-databases.md">SQL guide</a>.</p>

<p>For NoSQL databases, you have a few options. To run Zipkin with Cassandra for
example, you can copy the Cassandra configuration into the default
configuration, change the <code>bin</code> scripts to run the Cassandra configuration, or
run the full daemon commands that the <code>bin</code> scripts are invoking:</p>

<pre><code>bin/sbt &#39;project zipkin-collector-service&#39; &#39;run -f zipkin-collector-service/config/collector-cassandra.scala&#39;
bin/sbt &#39;project zipkin-query-service&#39; &#39;run -f zipkin-query-service/config/query-cassandra.scala&#39;
</code></pre>

<p>The <code>bin/web</code> script does not access the database so you do not need to change
anything there.</p>

<h3>Storage: Cassandra</h3>

<p>Zipkin runs on SQLite by default to make it easier to test out of the box.
Running Zipkin on SQLite requires no additional setup. However, in production,
Zipkin is most commonly used with <a href="http://cassandra.apache.org/">Cassandra</a> for
the collector&#39;s storage. There are also plugins for
<a href="https://github.com/twitter/zipkin/blob/master/doc/redis.md">Redis</a>, HBase, and
<a href="https://github.com/twitter/zipkin/blob/master/doc/sql-databases.md">other SQL databases</a>.</p>

<ol>
<li>See Cassandra&#39;s <a href="http://cassandra.apache.org/">site</a> for instructions on how to start a cluster.</li>
<li>Use the Zipkin Cassandra schema attached to this project. You can create the schema with the following command:
<code>cassandra-cli -host localhost -port 9160 -f zipkin-cassandra/src/schema/cassandra-schema.txt</code></li>
</ol>

<h3>Coordination: ZooKeeper</h3>

<p>Zipkin can use ZooKeeper for coordination. That&#39;s where we store the server side sample rate and register the servers.</p>

<ol>
<li>See ZooKeeper&#39;s <a href="http://zookeeper.apache.org/">site</a> for instructions on how to install it.</li>
</ol>

<h3>Collecting Data: Scribe</h3>

<p><a href="https://github.com/facebook/scribe">Scribe</a> is the logging
framework we use at Twitter to transport the trace data. There are several other
ways to tell Zipkin what trace data to collect; in particular, if you are just
trying out Zipkin you can skip this step entirely and point the ZipkinTracer
directly at the collector.</p>

<p>To use Scribe with Zipkin, you need to set up a network store that points to
the Zipkin collector daemon. A Scribe store for Zipkin might look something
like this:</p>

<pre><code>&lt;store&gt;
  category=zipkin
  type=network
  remote_host=123.123.123.123
  remote_port=9410
  use_conn_pool=yes
  default_max_msg_before_reconnect=50000
  allowable_delta_before_reconnect=12500
  must_succeed=no
&lt;/store&gt;
</code></pre>

<p>If you don&#39;t want to hardcode the IP address of your collector there are a few
options. One is to use an internal DNS entry for the collectors so that you only
have one place to change the addresses when you add or remove collectors.
Alternatively, if you want to get all fancy you can use a
<a href="https://github.com/traviscrawford/scribe">modified version of Scribe</a> that
picks up the collectors via ZooKeeper. When each collector starts up it adds
itself to ZooKeeper and when a collector shuts down it is automatically
removed. The modified Scribe gets notified when the set of collectors change.
To use this mode you change <code>remote_host</code> in the configuration to
<code>zk://zookeeper-hostname:2181/scribe/zipkin</code> or something similar.</p>

<p>We&#39;re hoping that others might add non-Scribe transports for the tracing data;
there is no reason why Scribe has to be the only one.</p>

<h3>Zipkin UI</h3>

<p>The UI is a standard Rails 3 app.</p>

<ol>
<li>Update config with your ZooKeeper server. This is used to find the query daemons.</li>
<li>Deploy to a suitable Rails 3 app server. For testing you can simply do
<code>
bundle install &amp;&amp;
bundle exec rails server.
</code></li>
</ol>

<h4>zipkin-tracer gem</h4>

<p>The <code>zipkin-tracer</code> gem adds tracing to a Rails application through the use of a Rack Handler.
In <code>config.ru</code>:</p>

<pre><code class="ruby">  use ZipkinTracer::RackHandler
  run &lt;YOUR_APPLICATION&gt;
</code></pre>

<p>If the application&#39;s static assets are served through Rails, those requests will be traced.</p>
        </section>
      </div>
      <footer class="footer">
        <div class="container">
          <p>Copyright 2012 Twitter, Inc.</p>
          <p>Licensed under the Apache License, Version 2.0: <a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a>
        </div>
      </footer>
  </body>
</html>
